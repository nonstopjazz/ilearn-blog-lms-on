# å­¸ç¿’ç®¡ç†ç³»çµ± - æ¶æ§‹åˆ†æå ±å‘Š

## ğŸ“Š ä¸€ã€è³‡æ–™åº«çµæ§‹åˆ†æ

### 1.1 æ ¸å¿ƒè³‡æ–™è¡¨

#### **vocabulary_sessions** (å–®å­—å­¸ç¿’è¿½è¹¤è¡¨)
- `student_id`: å­¸ç”Ÿ ID
- `course_id`: èª²ç¨‹ ID
- `session_date`: å­¸ç¿’æ—¥æœŸ
- `start_number` / `end_number`: ç´¯ç©ç·¨è™Ÿç¯„åœ
- `words_learned`: å­¸ç¿’å–®å­—æ•¸ï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰
- `accuracy_rate`: æ­£ç¢ºç‡
- `session_duration`: å­¸ç¿’æ™‚é•·ï¼ˆåˆ†é˜ï¼‰

#### **exam_records** (è€ƒè©¦æˆç¸¾ç®¡ç†è¡¨)
- `student_id`: å­¸ç”Ÿ ID
- `course_id`: èª²ç¨‹ ID
- `exam_type`: è€ƒè©¦é¡å‹ï¼ˆquiz, midterm, finalï¼‰
- `exam_name`: è€ƒè©¦åç¨±
- `exam_date`: è€ƒè©¦æ—¥æœŸ
- `total_score` / `max_score`: åˆ†æ•¸
- `percentage_score`: ç™¾åˆ†æ¯”ï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰
- `teacher_feedback`: è€å¸«å›é¥‹

#### **assignment_submissions** (ä½œæ¥­æäº¤è¨˜éŒ„è¡¨)
- `assignment_id`: ä½œæ¥­ ID
- `student_id`: å­¸ç”Ÿ ID
- `submission_date`: æäº¤æ—¥æœŸ
- `status`: ç‹€æ…‹ï¼ˆsubmitted, graded, returnedï¼‰
- `score` / `max_score`: åˆ†æ•¸
- `is_late`: æ˜¯å¦é²äº¤

#### **learning_progress_stats** (å­¸ç¿’é€²åº¦çµ±è¨ˆè¡¨)
- `student_id`: å­¸ç”Ÿ ID
- `course_id`: èª²ç¨‹ ID
- `week_number` / `year`: é€±æ¬¡ / å¹´ä»½
- `assignments_completed` / `assignments_total`: ä½œæ¥­å®Œæˆæ•¸
- `vocabulary_words_learned`: å–®å­—å­¸ç¿’æ•¸
- `vocabulary_accuracy`: å–®å­—æ­£ç¢ºç‡
- `quiz_average`: æ¸¬é©—å¹³å‡åˆ†æ•¸

#### **parent_notifications** (å®¶é•·é€šçŸ¥è¨˜éŒ„è¡¨)
- `student_id`: å­¸ç”Ÿ ID
- `notification_type`: é€šçŸ¥é¡å‹ï¼ˆweekly_report, exam_resultï¼‰
- `subject`: ä¸»æ—¨
- `content`: å…§å®¹
- `data`: JSONB æ ¼å¼çš„è©³ç´°æ•¸æ“š
- `sent_via`: ç™¼é€æ–¹å¼ï¼ˆemail, sms, in_appï¼‰
- `status`: ç‹€æ…‹ï¼ˆpending, sent, failedï¼‰

---

## ğŸ”Œ äºŒã€ç¾æœ‰ API æ¶æ§‹

### 2.1 å·²å¯¦ä½œçš„ API

#### `/api/learning/weekly-report`
**åŠŸèƒ½ï¼š** ç”Ÿæˆå­¸ç¿’é€±å ±

**GET åƒæ•¸ï¼š**
- `student_id`: å­¸ç”Ÿ ID
- `send_notification`: æ˜¯å¦ç™¼é€é€šçŸ¥

**è¿”å›æ•¸æ“šï¼š**
```json
{
  "success": true,
  "data": {
    "report": {
      "week_number": 5,
      "year": 2025,
      "assignments": { "total": 10, "completed": 8 },
      "vocabulary": { "total_words": 50, "avg_accuracy": 85 },
      "exams": { "count": 2, "avg_score": 88 }
    }
  }
}
```

**POST åŠŸèƒ½ï¼š** æ‰¹é‡ç”Ÿæˆæ‰€æœ‰å­¸ç”Ÿçš„é€±å ±

#### `/api/learning/exams`
**åŠŸèƒ½ï¼š** è€ƒè©¦æˆç¸¾ç®¡ç†ï¼ˆæ¨æ¸¬ï¼Œéœ€ç¢ºèªï¼‰

#### `/api/learning/vocabulary`
**åŠŸèƒ½ï¼š** å–®å­—å­¸ç¿’ç®¡ç†ï¼ˆæ¨æ¸¬ï¼Œéœ€ç¢ºèªï¼‰

#### `/api/learning/progress`
**åŠŸèƒ½ï¼š** å­¸ç¿’é€²åº¦ç®¡ç†ï¼ˆæ¨æ¸¬ï¼Œéœ€ç¢ºèªï¼‰

---

## ğŸ¨ ä¸‰ã€å‰ç«¯é é¢åˆ†æ

### 3.1 `/learning` é é¢ï¼ˆå­¸ç”Ÿç«¯ï¼‰

**ç›®å‰ç‹€æ³ï¼š**
- âœ… UI å·²å®Œæˆï¼ˆç¸½è¦½ã€ä½œæ¥­ç®¡ç†ã€æˆç¸¾ç®¡ç†ç­‰é ç±¤ï¼‰
- âŒ **ä½¿ç”¨æ¨¡æ“¬è³‡æ–™**ï¼Œæœªé€£æ¥è³‡æ–™åº«
- âŒ æœªæ•´åˆç™»å…¥ä½¿ç”¨è€…è³‡è¨Š

**è³‡æ–™ä¾†æºï¼š**
```typescript
// ç¡¬ç·¨ç¢¼çš„æ¨¡æ“¬è³‡æ–™
const allGradeData = [ /* å‡è³‡æ–™ */ ];
const allVocabularyData = [ /* å‡è³‡æ–™ */ ];
const assignmentsByWeek = [ /* å‡è³‡æ–™ */ ];
```

**ç¼ºå°‘çš„åŠŸèƒ½ï¼š**
1. å¾ API å–å¾—çœŸå¯¦è³‡æ–™
2. æ ¹æ“šç™»å…¥å­¸ç”Ÿ ID éæ¿¾è³‡æ–™
3. å³æ™‚æ›´æ–°è³‡æ–™

### 3.2 `/admin/learning-management` é é¢ï¼ˆç®¡ç†å“¡ç«¯ï¼‰

**ç›®å‰ç‹€æ³ï¼š**
- âœ… æœ‰å­¸ç”Ÿåˆ—è¡¨
- âœ… æœ‰ã€Œå ±å‘Šç”Ÿæˆã€ç›¸é—œ state
- âŒ å ±å‘Šç”ŸæˆåŠŸèƒ½æœªå®Œæˆ

**ç¾æœ‰åŠŸèƒ½ï¼š**
```typescript
const [isGeneratingReport, setIsGeneratingReport] = useState(false);
const [reportStudent, setReportStudent] = useState<Student | null>(null);
```

---

## ğŸ”— å››ã€å‰å¾Œç«¯æ•´åˆç¼ºå£

### 4.1 `/learning` é é¢éœ€è¦é€£æ¥çš„ API

| é ç±¤ | éœ€è¦çš„è³‡æ–™ | å°æ‡‰çš„è³‡æ–™è¡¨ | éœ€è¦çš„ API |
|------|-----------|------------|-----------|
| ç¸½è¦½ - çµ±è¨ˆå¡ç‰‡ | æœ¬é€±ä½œæ¥­æ•¸ã€å®Œæˆç‡ | `assignment_submissions` | `/api/learning/stats` |
| ç¸½è¦½ - æˆç¸¾è¶¨å‹¢ | è€ƒè©¦æˆç¸¾æ­·å² | `exam_records` | `/api/learning/exams` |
| ç¸½è¦½ - å–®å­—å­¸ç¿’ | å–®å­—å­¸ç¿’è¨˜éŒ„ | `vocabulary_sessions` | `/api/learning/vocabulary` |
| ç¸½è¦½ - ä½œæ¥­è¿½è¹¤ | ä½œæ¥­å®Œæˆç‹€æ³ | `assignments` + `assignment_submissions` | `/api/learning/assignments` |
| æˆç¸¾ç®¡ç† | è€ƒè©¦è¨˜éŒ„åˆ—è¡¨ | `exam_records` | `/api/learning/exams` |
| å–®å­—å­¸ç¿’ | å–®å­—å­¸ç¿’è¨˜éŒ„ | `vocabulary_sessions` | `/api/learning/vocabulary` |

### 4.2 ç¼ºå°‘çš„ API

1. **`/api/learning/stats`** - å–å¾—å­¸ç”Ÿçš„å­¸ç¿’çµ±è¨ˆ
2. **`/api/learning/assignments`** - å–å¾—ä½œæ¥­è³‡æ–™ï¼ˆå«æäº¤ç‹€æ³ï¼‰
3. **`/api/admin/students/[id]/learning-data`** - ç®¡ç†å“¡æŸ¥çœ‹å–®ä¸€å­¸ç”Ÿå®Œæ•´è³‡æ–™

---

## ğŸ“‹ äº”ã€åŒ¯å‡º PDF + Email åŠŸèƒ½è¦åŠƒ

### 5.1 è³‡æ–™æµç¨‹

```
1. ç®¡ç†å“¡åœ¨ /admin/learning-management é¸æ“‡å­¸ç”Ÿ
   â†“
2. é»æ“Šã€ŒæŸ¥çœ‹/åŒ¯å‡ºå ±å‘Šã€
   â†“
3. ç³»çµ±å‘¼å« API å–å¾—è©²å­¸ç”Ÿçš„å­¸ç¿’è³‡æ–™
   â†“
4. ä½¿ç”¨ /learning çš„ UI çµ„ä»¶æ¸²æŸ“å ±å‘Š
   â†“
5. ä½¿ç”¨ react-to-pdf è½‰æ›ç‚º PDF
   â†“
6. é€é Resend API å¯„é€ Email
```

### 5.2 éœ€è¦æ–°å¢çš„åŠŸèƒ½

#### **å‰ç«¯ï¼š**
1. `/admin/learning-management` åŠ å…¥ã€Œå ±å‘Šæ“ä½œã€æŒ‰éˆ•
2. å»ºç«‹ã€Œå ±å‘Šé è¦½ã€å½ˆå‡ºè¦–çª—ï¼ˆè¤‡ç”¨ `/learning` UIï¼‰
3. PDF åŒ¯å‡ºåŠŸèƒ½
4. Email å¯„é€ä»‹é¢ï¼ˆæ”¶ä»¶äººé¸æ“‡ã€è‡ªè¨‚å…§å®¹ï¼‰

#### **å¾Œç«¯ï¼š**
1. **`/api/admin/generate-report`** - ç”Ÿæˆ PDF å ±å‘Š
2. **`/api/admin/send-report-email`** - å¯„é€å ±å‘Š Email
3. **`/api/admin/schedule-reports`** - è¨­å®šè‡ªå‹•æ’ç¨‹

#### **è³‡æ–™åº«ï¼š**
1. å¯èƒ½éœ€è¦æ–°å¢ `report_templates` è¡¨ï¼ˆå ±å‘Šæ¨¡æ¿è¨­å®šï¼‰
2. å¯èƒ½éœ€è¦æ–°å¢ `report_schedules` è¡¨ï¼ˆè‡ªå‹•æ’ç¨‹è¨­å®šï¼‰

---

## âœ… å…­ã€ä¸‹ä¸€æ­¥è¡Œå‹•å»ºè­°

### å„ªå…ˆç´š 1ï¼ˆå¿…é ˆï¼‰ï¼š
1. âœ… å»ºç«‹ `/api/learning/*` çš„å®Œæ•´ API
2. âœ… å°‡ `/learning` é é¢å¾æ¨¡æ“¬è³‡æ–™æ”¹ç‚ºçœŸå¯¦è³‡æ–™
3. âœ… å¯¦ä½œä½¿ç”¨è€…èº«ä»½é©—è­‰ï¼ˆç¢ºä¿å­¸ç”Ÿåªçœ‹åˆ°è‡ªå·±çš„è³‡æ–™ï¼‰

### å„ªå…ˆç´š 2ï¼ˆå ±å‘ŠåŠŸèƒ½ï¼‰ï¼š
4. âœ… åœ¨ `/admin/learning-management` å¯¦ä½œå ±å‘Šé è¦½
5. âœ… å¯¦ä½œ PDF åŒ¯å‡ºåŠŸèƒ½
6. âœ… æ•´åˆ Email å¯„é€åŠŸèƒ½

### å„ªå…ˆç´š 3ï¼ˆé€²éšåŠŸèƒ½ï¼‰ï¼š
7. â° å¯¦ä½œè‡ªå‹•æ’ç¨‹åŠŸèƒ½
8. â° æ‰¹é‡åŒ¯å‡ºåŠŸèƒ½
9. â° å ±å‘Šæ¨¡æ¿è‡ªè¨‚åŠŸèƒ½

---

## ğŸ¯ ä¸ƒã€æŠ€è¡“æ–¹æ¡ˆå»ºè­°

### PDF ç”Ÿæˆæ–¹æ¡ˆï¼š
**æ¨è–¦ï¼šreact-to-pdf**
- å®‰è£ï¼š`npm install react-to-pdf`
- å„ªé»ï¼šç°¡å–®æ˜“ç”¨ã€èˆ‡ç¾æœ‰ UI æ•´åˆæ–¹ä¾¿
- é©åˆï¼šç›´æ¥å°‡ `/learning` ç¸½è¦½é ç±¤è½‰ç‚º PDF

### Email å¯„é€æ–¹æ¡ˆï¼š
**ä½¿ç”¨ç¾æœ‰çš„ Resend API**
- å·²é…ç½®å¥½ç’°å¢ƒè®Šæ•¸
- æ”¯æ´ PDF é™„ä»¶
- éœ€è¦å»ºç«‹ Email æ¨¡æ¿

### è³‡æ–™æ•´åˆæ–¹æ¡ˆï¼š
**å»ºè­°ä½¿ç”¨ React Query (TanStack Query)**
- å®‰è£ï¼š`npm install @tanstack/react-query`
- å„ªé»ï¼šè‡ªå‹•å¿«å–ã€è‡ªå‹•é‡æ–°è¼‰å…¥ã€éŒ¯èª¤è™•ç†
- é©åˆï¼šç®¡ç†è¤‡é›œçš„è³‡æ–™æµç¨‹

---

## ğŸ“ å…«ã€éœ€è¦ç¢ºèªçš„å•é¡Œ

1. **å­¸ç”Ÿ ID å¦‚ä½•å–å¾—ï¼Ÿ**
   - å¾ AuthContext å–å¾—ï¼Ÿ
   - å¾ URL åƒæ•¸å–å¾—ï¼Ÿ

2. **å®¶é•· Email å„²å­˜åœ¨å“ªï¼Ÿ**
   - `profiles` è¡¨ï¼Ÿ
   - éœ€è¦æ–°å¢ `parents` è¡¨ï¼Ÿ

3. **å ±å‘Šç”Ÿæˆæ™‚æ©Ÿï¼Ÿ**
   - å³æ™‚ç”Ÿæˆï¼ˆæ¯æ¬¡é»æ“Šæ™‚ç”Ÿæˆï¼‰
   - é å…ˆç”Ÿæˆï¼ˆç³»çµ±å®šæœŸç”Ÿæˆä¸¦å¿«å–ï¼‰

4. **è³‡æ–™ç¯„åœï¼Ÿ**
   - åªé¡¯ç¤ºç•¶å‰å­¸æœŸï¼Ÿ
   - é¡¯ç¤ºæ‰€æœ‰æ­·å²è³‡æ–™ï¼Ÿ
   - å¯è‡ªè¨‚æ—¥æœŸç¯„åœï¼Ÿ

5. **æ¬Šé™æ§åˆ¶ï¼Ÿ**
   - å“ªäº›ç®¡ç†å“¡å¯ä»¥åŒ¯å‡ºå ±å‘Šï¼Ÿ
   - å­¸ç”Ÿèƒ½è‡ªå·±åŒ¯å‡ºå ±å‘Šå—ï¼Ÿ
